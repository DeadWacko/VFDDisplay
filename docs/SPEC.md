# VFD Display — SPECIFICATION

Этот файл описывает цели проекта, список функций, уровни реализации
и Roadmap. Документ обновлён с учётом выполненной LL/HL-реорганизации,
добавления dot-blink, и текущего состояния миграции из легаси.

---

## 1. Цели проекта

- Создать полностью модульную библиотеку для управления VFD- и 7-сегментными
  индикаторами на Raspberry Pi Pico / RP2040.
- Разделить уровни:
  - LL (железо)
  - HL-core (логика отображения)
  - CONTENT (числа, текст, время)
  - FX (эффекты)
  - OVERLAY (временные режимы)
- Сделать архитектуру расширяемой, удобной для будущих версий часов.

---

## 2. Обязательные возможности

### 2.1. Низкоуровневый уровень (LL)
- ✔ Управление сдвиговыми регистрами (data/clock/latch)
- ✔ Фоновое мультиплексирование разрядов
- ✔ Программный PWM яркости на каждый разряд
- ✔ Гамма-коррекция
- ✔ Потокобезопасные буферы (spinlock)
- ✔ Поддержка до 10 разрядов

**Статус: выполнено 100%.**

---

### 2.2. Высокоуровневый уровень (HL-core)
- ✔ Управление глобальной яркостью
- ✔ Управление dot-blink (двоеточием)
- ✔ Хранение hl_buffer[]
- ✔ display_process() как heartbeat
- ❏ Ночной режим
- ❏ Автоматическая яркость (фоторезистор)
- ❏ RTC-обновление времени
- ❏ Ведение статуса режимов (CONTENT / FX / OVERLAY)

**Статус: выполнено ~70–80%.**

---

### 2.3. CONTENT-уровень
- ✔ Числа (`display_show_number`)
- ✔ Время (`display_show_time`)
- ✔ Дата (`display_show_date`)
- ✔ Текст (`display_show_text`)
- ✔ Единая таблица сегментов (display_font.c)
- ❏ Прокрутка текста
- ❏ Морфинг цифр
- ❏ Дополнительные шрифты

**Статус: выполнено ~70%.**

---

### 2.4. FX — эффектный уровень
(ещё не перенесён из легаси, структура определена)

Планируемые эффекты:

- ❏ FADE IN (плавное появление)
- ❏ FADE OUT (плавное исчезновение)
- ❏ WAVE (волна яркости)
- ❏ PULSE (дыхание)
- ❏ GLITCH / FLICKER (рандомное мерцание)
- ❏ DISSOLVE (рассыпание сегментов)
- ❏ MORPH TO (переход цифры → цифру)

Каждый эффект:
- работает внутри `display_process()`
- имеет собственный state-machine
- временно захватывает вывод
- возвращает управление CONTENT после завершения

**Статус: 0% (ожидает переноса).**

---

### 2.5. OVERLAY — временные состояния поверх контента

Оверлеи:
- ❏ boot animation
- ❏ Wi-Fi connecting
- ❏ NTP sync
- ❏ Error overlay

Особенности:
- сохраняют CONTENT буфер
- рисуют поверх
- освобождают управление по завершении

**Статус: 0% (ожидает переноса).**

---

## 3. Архитектура обновления кадра

Полный путь данных:

APP → CONTENT → HL (dot-blink / FX / overlay) → LL → hardware

Обновление экрана выполняется через: void display_process();

Эта функция должна вызываться из главного цикла приложения
с периодичностью 10–50 Гц (по рекомендациям).

---

## 4. Roadmap

### ✔ 0.1.0 — Legacy
Старый монолитный `display.c`.

### ✔ 0.2.0 — LL/HL разделение
- LL: полный рефакторинг
- HL-core: базовая логика + яркость
- CONTENT: числа/текст/время/дата
- dot-blink перенесён
- обновлён API и архитектура

**Статус: выполнено.**

---

### ⬜ 0.3.0 — перенос эффектов (FX)
- Fade In / Fade Out
- Pulse
- Wave
- Flicker
- Morph-to
- Dissolve
- display_fx.c + единый state machine

**Статус: предстоит.**

---

### ⬜ 0.4.0 — перенос оверлеев (OVERLAY)
- boot
- connecting Wi-Fi
- NTP sync
- error display
- display_overlay.c

---

### ⬜ 0.5.0 — улучшения времени и яркости
- автояркость (фоторезистор)
- ночной режим
- RTC-обновление времени
- плавное переключение режимов

---

### ⬜ 0.6.0 — дополнительные возможности
- текстовые эффекты
- кастомные шрифты
- скроллинг
- расширенный CONTENT API

---

## 5. Статус реализации (коротко)

| Модуль        | Готовность |
|---------------|------------|
| LL            | 100%       |
| HL-core       | 70–80%     |
| CONTENT       | 70%        |
| FX            | 0%         |
| OVERLAY       | 0%         |
| AUTO BRIGHT   | 0%         |
| NIGHT MODE    | 0%         |
| RTC UPDATE    | 0%         |

---

## 6. Примечания

Документ обновляется по мере переноса функций из легаси.

